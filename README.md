## 如何产生10000以内不重复的随机数？

本工具专为解决这个问题而生。只要给定3个参数：`max`(取值范围)，`deep`(映射次数)，`seed`(哈希种子)就可以产生一个范围为`[0, max-1]`的随机数列。本工具的特点有：

1. 不重复，`[0, max-1]`区间内的数乱序出现，每个只出现一次

2. 可重现，只要保存`max`, `deep`, `seed` 三个参数，就可重现序列

3. 重现不依赖数据库，数列每一项值都是动态计算，仅仅依赖`max`, `deep`, `seed` 三个参数。我们甚至可以把这三个参数记在脑中

4. 随机，**随机**是个伪命题，爱因斯坦说上帝不掷骰子，只要给定宇宙的所有初始状态和物理规律，就可以推导任意时刻的状态。即使是量子物理也只是因为人类的观察会干扰量子的运动，而得出“上帝亦掷骰子”的结论。此工具中，只要取值范围(`max`)和映射深度(`deep`)足够大，很难从一个序列反推出`seed`从而破解该数列

5. 快速，产生随机数列的过程都是简单的`位运算`

### Usages
#### Scala
```sbt
resolvers += "yuxiaobo" at "http://code.yuxiaobo.com/repository"
```

```scala
    val max = 1000
    val rs = RandomSerial(max, 10, 80)
    // print serial
    0.until(max).map(rs(_)).foreach(println)
```

#### Java 8+
```xml
    <repositories>
        <repository>
            <id>yuxiaobo</id>
            <url>http://code.yuxiaobo.com/repository</url>
        </repository>
    </repositories>
```

```java
  int max = 1000; // max value 
  int deep = 10; // hash times
  long seed = 3348203884722039l; // random 
  RandomSerial rs = new RandomSerial(max, deep, seed);
  // print serial
  IntStream.range(0, max).map(rs::apply).foreach(System.out::println)
```

### 实现细节

#### 2<sup>n</sup>数值的映射

2<sup>n</sup>正好是n个`bit`，可以通过一些简单的位操作打乱数列的顺序。下面以2<sup>4</sup>来举例

##### 位交换

2<sup>4</sup>二进制4位数的原始顺序为`3-2-1-0`，随机调整顺序，如`2-3-0-1`，或者`1-3-0-2`，对应的数值：

| 序号 | 3-2-1-0 | 2-3-0-1| 序列A | 1-3-0-2 | 序列B |
|----|----|----|----|----|----|
| 0 | 0000 | 0000 | 0 | 0000 | 0 |
| 1 | 0001 | 0010 | 2 | 0010 | 2 |
| 2 | 0010 | 0001 | 1 | 1000 | 8 |
| 3 | 0011 | 0011 | 3 | 1010 | 10 |
| 4 | 0100 | 1000 | 8 | 0100 | 4 |
| 5 | 0101 | 1010 | 10 | 0011 | 3 |
| 6 | 0110 | 1001 | 9 | 1001 | 9 |
| 7 | 0111 | 1011 | 11 | 1011 | 11 |
| 8 | 1000 | 0100 | 4 | 0100 | 4 |
| 9 | 1001 | 0110 | 6 | 0110 | 6 |
| 10 | 1010 | 0101 | 5 | 1100 | 12 |
| 11 | 1011 | 0111 | 7 | 1110 | 14 |
| 12 | 1100 | 1100 | 12 | 0101 | 5 |
| 13 | 1101 | 1110 | 14 | 0111 | 7 |
| 14 | 1110 | 1101 | 13 | 1101 | 13 |
| 15 | 1111 | 1111 | 15 | 1111 | 15 |

##### 位取反

在上一步的基础上，随机找某几位取反，以上一步的 序列B(`1-3-0-2`) 为例，序列中每个数分别与`1010`、`0011`异或。

| 序号 | 1-3-0-2 | 序列B | 1010 | 序列X | 0011 | 序列Y |
|----|----|----|----|----|----|----|
| 0 | 0000 | 0 | 1010 | 10 | 0011 | 3 |
| 1 | 0010 | 2 | 1000 | 8 | 0001 | 1 |
| 2 | 1000 | 8 | 0010 | 2 | 1011 | 11 |
| 3 | 1010 | 10 | 0000 | 0 | 1001 | 9 |
| 4 | 0100 | 4 | 1110 | 14 | 0111 | 7 |
| 5 | 0011 | 3 | 1001 | 9 | 0000 | 0 |
| 6 | 1001 | 9 | 0011 | 3 | 1010 | 10 |
| 7 | 1011 | 11 | 0001 | 1 | 1000 | 8 |
| 8 | 0100 | 4 | 1110 | 14 | 0111 | 7 |
| 9 | 0110 | 6 | 1100 | 12 | 0101 | 5 |
| 10 | 1100 | 12 | 0110 | 6 | 1111 | 15 |
| 11 | 1110 | 14 | 0100 | 4 | 1101 | 13 |
| 12 | 0101 | 5 | 1111 | 15 | 0110 | 6 |
| 13 | 0111 | 7 | 1101 | 13 | 0100 | 4 |
| 14 | 1101 | 13 | 0111 | 7 | 1110 | 14 |
| 15 | 1111 | 15 | 0101 | 5 | 1100 | 12 |

现在有两个问题：

1. 非2<sup>n</sup>怎么办，比如100，不能直接通过位移的方式进行映射，因为100需要7位二进制数表示，位移之后有些结果超出100，而100以内的数值会有空缺，并且两者很难建立普遍的联系。
1. 数列不够随机

#### 非2<sup>n</sup>数值的映射
1. 拆分，这个2<sup>n</sup>为`max`，将它拆分成若干个2<sup>n</sup>之和，然后在各自的范围内进行映射。如`100=64+32+4`，映射关系为 [0~63]=>[0~63], [64~95]=>[64~95], [96~99]=>[96~99] 
    
2. 错位，将上一步得出的结果加上 `N * distance` 然后与`max`取模。 `distance` 为初始参数`max`, `deep`, `seed` 哈希计算的值，上一步和这一步会计算多次，`N`的值每次递减，初始值为`deep`。

3. 重复，将第2步的结果作为第一步的输入重复计算，共`deep`次。

### 举例

`max=100, deep=10, seed=1`: 42, 18, 33, 63, 77, 28, 43, 62, 59, 14, 99, 76, 51, 45, 75, 11, 84, 65, 56, 19, 39, 4, 69, 87, 57, 12, 96, 67, 79, 49, 97, 95, 38, 94, 1, 68, 40, 86, 50, 60, 41, 31, 9, 0, 29, 10, 90, 66, 70, 13, 36, 89, 7, 16, 2, 47, 91, 71, 30, 98, 80, 22, 82, 83, 61, 8, 34, 58, 44, 24, 64, 25, 73, 17, 20, 21, 26, 48, 92, 46, 35, 88, 37, 93, 85, 55, 78, 3, 32, 53, 54, 52, 15, 81, 23, 6, 74, 72, 27, 5

`max=100, deep=10, seed=2`: 96, 85, 95, 6, 98, 12, 4, 59, 36, 87, 86, 8, 41, 60, 75, 52, 61, 69, 66, 33, 29, 72, 25, 42, 28, 73, 24, 99, 70, 49, 50, 7, 31, 64, 32, 63, 39, 44, 43, 71, 78, 37, 54, 35, 67, 40, 62, 48, 97, 27, 34, 74, 79, 2, 68, 94, 9, 0, 26, 92, 20, 88, 1, 89, 56, 3, 57, 38, 77, 51, 90, 83, 84, 5, 53, 46, 16, 45, 82, 58, 55, 17, 21, 80, 30, 47, 13, 81, 22, 19, 14, 11, 18, 65, 10, 91, 23, 76, 15, 93

`max=1000, deep=10, seed=2`: 974, 400, 114, 789, 583, 873, 394, 543, 536, 575, 270, 842, 919, 4, 551, 549, 29, 441, 470, 46, 513, 520, 36, 805, 645, 584, 281, 14, 803, 881, 996, 530, 63, 878, 280, 214, 155, 112, 685, 347, 132, 43, 317, 467, 257, 711, 333, 552, 651, 95, 215, 763, 261, 291, 82, 175, 159, 329, 661, 859, 538, 501, 700, 227, 307, 234, 27, 118, 438, 778, 487, 926, 855, 890, 775, 856, 876, 322, 922, 211, 462, 969, 241, 455, 163, 977, 507, 380, 910, 348, 205, 209, 905, 717, 364, 745, 420, 92, 597, 208, 503, 912, 119, 573, 719, 128, 383, 718, 527, 999, 136, 313, 529, 418, 877, 816, 260, 349, 306, 941, 747, 510, 676, 949, 363, 326, 451, 475, 607, 742, 289, 279, 389, 476, 98, 252, 45, 911, 449, 832, 746, 837, 771, 113, 667, 399, 743, 460, 637, 784, 204, 89, 869, 561, 690, 305, 76, 954, 486, 533, 636, 741, 810, 560, 201, 590, 477, 653, 324, 639, 734, 917, 563, 139, 336, 770, 792, 688, 369, 68, 468, 509, 884, 931, 802, 817, 170, 744, 534, 752, 371, 360, 886, 60, 540, 824, 918, 831, 814, 471, 670, 448, 694, 11, 909, 854, 971, 217, 966, 19, 879, 723, 970, 923, 624, 713, 871, 450, 435, 122, 9, 310, 945, 366, 386, 935, 290, 727, 181, 396, 631, 944, 303, 791, 649, 116, 648, 79, 194, 850, 830, 625, 815, 748, 962, 255, 613, 117, 196, 463, 442, 852, 287, 382, 157, 605, 6, 102, 185, 351, 25, 121, 519, 323, 212, 419, 53, 602, 973, 248, 517, 256, 813, 203, 894, 990, 672, 739, 681, 246, 32, 634, 105, 818, 799, 331, 847, 247, 556, 979, 557, 773, 391, 627, 740, 358, 251, 643, 992, 202, 94, 777, 822, 411, 537, 647, 764, 720, 141, 126, 531, 97, 416, 57, 965, 190, 20, 907, 948, 374, 546, 782, 355, 646, 981, 130, 915, 398, 169, 59, 593, 160, 985, 885, 161, 562, 173, 998, 691, 800, 39, 354, 621, 265, 809, 946, 150, 69, 133, 301, 240, 294, 219, 891, 705, 384, 887, 221, 599, 838, 682, 843, 62, 833, 86, 836, 111, 930, 311, 367, 795, 834, 23, 110, 491, 660, 988, 320, 669, 140, 465, 321, 579, 598, 807, 587, 466, 177, 174, 845, 218, 434, 500, 892, 774, 433, 754, 484, 656, 192, 798, 644, 776, 588, 220, 808, 166, 642, 482, 693, 858, 461, 578, 88, 868, 277, 835, 242, 840, 657, 107, 282, 861, 874, 779, 708, 674, 733, 684, 481, 197, 610, 786, 606, 865, 350, 81, 238, 432, 797, 483, 359, 375, 337, 35, 377, 345, 526, 595, 788, 353, 525, 502, 404, 753, 50, 381, 828, 544, 495, 819, 594, 73, 236, 452, 444, 600, 288, 841, 406, 612, 706, 447, 232, 464, 701, 3, 142, 284, 522, 401, 37, 237, 431, 312, 52, 316, 229, 628, 440, 158, 430, 422, 925, 554, 585, 703, 91, 514, 315, 553, 811, 200, 373, 675, 827, 633, 368, 849, 425, 189, 565, 709, 614, 71, 61, 286, 952, 40, 759, 84, 757, 104, 714, 42, 901, 127, 630, 83, 566, 572, 191, 867, 493, 928, 916, 547, 908, 472, 17, 603, 986, 407, 978, 806, 622, 207, 617, 523, 180, 942, 378, 135, 228, 34, 456, 397, 939, 402, 410, 677, 390, 539, 176, 408, 193, 314, 604, 72, 664, 385, 417, 245, 548, 77, 299, 437, 478, 1, 710, 195, 515, 2, 124, 93, 340, 387, 839, 577, 668, 576, 497, 41, 511, 129, 352, 250, 13, 304, 231, 671, 274, 716, 564, 183, 409, 976, 38, 860, 309, 960, 570, 213, 283, 222, 343, 638, 10, 344, 168, 596, 244, 300, 783, 541, 165, 872, 848, 961, 620, 298, 258, 793, 49, 54, 78, 692, 641, 120, 983, 370, 589, 724, 574, 898, 264, 601, 632, 571, 293, 206, 893, 663, 445, 123, 518, 446, 972, 582, 235, 272, 152, 278, 780, 659, 980, 357, 103, 904, 249, 938, 927, 154, 273, 372, 413, 485, 403, 731, 297, 138, 365, 427, 226, 346, 508, 338, 85, 308, 924, 550, 880, 115, 325, 920, 423, 335, 581, 267, 857, 853, 698, 820, 618, 75, 108, 984, 785, 233, 906, 243, 225, 635, 781, 137, 459, 262, 902, 210, 870, 5, 937, 15, 683, 474, 751, 766, 164, 275, 488, 755, 823, 361, 22, 144, 687, 149, 738, 436, 48, 8, 429, 100, 99, 55, 392, 679, 568, 863, 866, 559, 292, 680, 591, 678, 844, 704, 56, 388, 67, 494, 454, 96, 199, 794, 421, 266, 765, 932, 997, 151, 951, 332, 327, 899, 405, 125, 253, 223, 51, 328, 825, 302, 379, 615, 259, 28, 342, 131, 964, 516, 319, 31, 673, 480, 640, 929, 736, 271, 883, 184, 662, 101, 760, 967, 428, 888, 665, 933, 0, 737, 532, 285, 567, 619, 524, 458, 626, 134, 167, 826, 654, 796, 172, 558, 106, 334, 950, 198, 721, 521, 702, 772, 722, 864, 689, 498, 652, 829, 991, 699, 611, 580, 555, 109, 735, 153, 623, 504, 715, 695, 959, 608, 889, 846, 592, 362, 7, 341, 903, 994, 934, 882, 469, 186, 956, 296, 148, 412, 897, 216, 254, 616, 658, 330, 989, 187, 650, 269, 801, 947, 506, 851, 993, 33, 356, 586, 171, 87, 913, 44, 295, 414, 963, 182, 569, 147, 143, 875, 666, 914, 655, 862, 535, 545, 730, 339, 712, 58, 955, 729, 492, 750, 968, 725, 318, 145, 707, 65, 12, 90, 769, 762, 900, 542, 457, 895, 629, 505, 24, 80, 767, 732, 749, 726, 499, 376, 179, 16, 758, 975, 268, 47, 162, 728, 70, 26, 66, 821, 415, 790, 921, 224, 512, 756, 958, 957, 528, 686, 982, 987, 940, 696, 496, 393, 768, 156, 943, 18, 490, 64, 787, 479, 426, 761, 263, 812, 953, 30, 489, 188, 443, 936, 473, 697, 230, 74, 395, 276, 146, 995, 239, 609, 21, 453, 896, 439, 178, 424, 804
